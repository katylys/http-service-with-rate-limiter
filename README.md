# HTTP-сервис, способный ограничивать количество запросов по подсетке в момент времени

### Описание инструментов

В проекте используются:
- Flask==1.1.2 
- Flask-HTTPAuth==4.0.0
- Flask-Limiter==1.2.1
- Flask-SQLAlchemy==2.4.1
- Werkzeug==1.0.1

Для равномерного ограничения запросов в момент выбран алгоритм **Sliding Window (скользящее окно)**.
В этом алгоритме отслеживается счётчик для каждого окна, а затем учитывается взвешенное значение частоты запросов предыдущего окна на основе текущей временной метки, чтобы сгладить всплески трафика.

## Описание работы сервиса

По умолчанию сервер в докер-контейнере работает с настройками: ограничение для подсети /24 (маска 255.255.255.0), лимит 100 запросов в минуту, время ожидания после ограничения: 2 минуты.

При начале работы сервиса добавлять подсети в белый список может только аккаунт с логином *admin* и паролем *password*. Новых пользователей может создавать только *admin*. Добавленные пользователи также смогут добавлять подсети в белый список.

 Начальная страница, которая будет открываться на любые запросы, кроме POST /white_list и /new_user

	curl -i --header "X-Forwarded-For: 127.0.0.2" http://127.0.0.1:5000/


 Сброс лимита по префиксу

	curl -u admin:password -i -X POST -H "Content-Type: application/json" -d "{\"subnet\":\"127.0.0.0\"}" http://127.0.0.1:5000/white_list_subnet


Создание нового пользователя(этот handler необходим для защищенного сброса лимита, то есть неавторизованный пользователь не сможет сбросить лимит)

    curl -u admin:password -i -H "Content-Type: application/json" -X POST -d "{\"username\":\"abc\", \"password\":\"abc\"}" 127.0.0.1:5000/new_user


## Запуск сервиса
Клонирование репозитория

    git clone https://github.com/katylys/http_service_with_rate_limiter.git

Переход в папку с проектом

    cd http_service_with_rate_limiter

Установить все нужные зависимости

    pip install -r requirements.txt

Запуск сервиса с параметрами по умолчанию

    python run.py 24 120 "100 per 1 minute"

Можно запускать без параметров, что будет означать - сервис с доступом без ограничений

Запуск контейнера с работающим http-сервисом

    docker-compose up
